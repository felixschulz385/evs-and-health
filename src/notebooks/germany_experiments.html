<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Felix Schulz">
<meta name="dcterms.date" content="2025-11-20">

<title>EVs and Health: Experiments for Germany</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="germany_experiments_files/libs/clipboard/clipboard.min.js"></script>
<script src="germany_experiments_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="germany_experiments_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="germany_experiments_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="germany_experiments_files/libs/quarto-html/popper.min.js"></script>
<script src="germany_experiments_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="germany_experiments_files/libs/quarto-html/anchor.min.js"></script>
<link href="germany_experiments_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="germany_experiments_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="germany_experiments_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="germany_experiments_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="germany_experiments_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#todo" id="toc-todo" class="nav-link active" data-scroll-target="#todo">TODO</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-loading" id="toc-data-loading" class="nav-link" data-scroll-target="#data-loading">Data Loading</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul>
  <li><a href="#data-validation" id="toc-data-validation" class="nav-link" data-scroll-target="#data-validation">Data Validation</a></li>
  <li><a href="#merge-and-lag-structure" id="toc-merge-and-lag-structure" class="nav-link" data-scroll-target="#merge-and-lag-structure">Merge and Lag Structure</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul>
  <li><a href="#twfe-and-2sls-estimates" id="toc-twfe-and-2sls-estimates" class="nav-link" data-scroll-target="#twfe-and-2sls-estimates">TWFE and 2SLS Estimates</a>
  <ul>
  <li><a href="#lag-structure-analysis" id="toc-lag-structure-analysis" class="nav-link" data-scroll-target="#lag-structure-analysis">Lag Structure Analysis</a>
  <ul class="collapse">
  <li><a href="#first-stage-instrument-strength-across-lags" id="toc-first-stage-instrument-strength-across-lags" class="nav-link" data-scroll-target="#first-stage-instrument-strength-across-lags">First Stage: Instrument Strength Across Lags</a></li>
  <li><a href="#twfe-effect-timing" id="toc-twfe-effect-timing" class="nav-link" data-scroll-target="#twfe-effect-timing">TWFE: Effect Timing</a></li>
  </ul></li>
  <li><a href="#pre-covid-analysis" id="toc-pre-covid-analysis" class="nav-link" data-scroll-target="#pre-covid-analysis">Pre-COVID Analysis</a></li>
  <li><a href="#pre-covid-all-causes" id="toc-pre-covid-all-causes" class="nav-link" data-scroll-target="#pre-covid-all-causes">Pre-COVID: All Causes</a></li>
  <li><a href="#pre-covid-respiratory-diseases" id="toc-pre-covid-respiratory-diseases" class="nav-link" data-scroll-target="#pre-covid-respiratory-diseases">Pre-COVID: Respiratory Diseases</a></li>
  <li><a href="#pre-covid-results-comparison" id="toc-pre-covid-results-comparison" class="nav-link" data-scroll-target="#pre-covid-results-comparison">Pre-COVID Results Comparison</a></li>
  <li><a href="#heterogeneity-analysis-sample-splits" id="toc-heterogeneity-analysis-sample-splits" class="nav-link" data-scroll-target="#heterogeneity-analysis-sample-splits">Heterogeneity Analysis: Sample Splits</a>
  <ul class="collapse">
  <li><a href="#coefficient-plots-by-state" id="toc-coefficient-plots-by-state" class="nav-link" data-scroll-target="#coefficient-plots-by-state">Coefficient Plots: By State</a></li>
  <li><a href="#coefficient-plots-city-vs.-rural" id="toc-coefficient-plots-city-vs.-rural" class="nav-link" data-scroll-target="#coefficient-plots-city-vs.-rural">Coefficient Plots: City vs.&nbsp;Rural</a></li>
  <li><a href="#coefficient-plots-east-vs.-west-germany" id="toc-coefficient-plots-east-vs.-west-germany" class="nav-link" data-scroll-target="#coefficient-plots-east-vs.-west-germany">Coefficient Plots: East vs.&nbsp;West Germany</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multi-stage-iv-adding-0-th-stage" id="toc-multi-stage-iv-adding-0-th-stage" class="nav-link" data-scroll-target="#multi-stage-iv-adding-0-th-stage">Multi-Stage IV: Adding 0-th Stage</a></li>
  <li><a href="#robustness-additional-control-variables" id="toc-robustness-additional-control-variables" class="nav-link" data-scroll-target="#robustness-additional-control-variables">Robustness: Additional Control Variables</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EVs and Health: Experiments for Germany</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Felix Schulz </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 20, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="todo" class="level1">
<h1>TODO</h1>
<p>This section outlines the methodological improvements and robustness checks needed for the analysis.</p>
<p><strong>1. Temporal Lag Structure</strong></p>
<p>Implement proper temporal relationships between variables to capture causal effects:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Apply correct lag structure:</label>
<ul>
<li>Health outcome → <strong>t</strong> (current period)</li>
<li>BEV adoption → <strong>t-1</strong> (one-year lag to capture delayed health effects)</li>
<li>Charging infrastructure (PV) → <strong>t-2</strong> (two-year lag: infrastructure affects BEV adoption with delay)</li>
<li>Solar radiation (GR) → <strong>t-3</strong> (three-year lag: radiation affects infrastructure deployment)</li>
</ul></li>
<li><label><input type="checkbox" checked="">Verify consistency: Ensure <strong>PV_t-2 = LPV_t-1</strong> in the dataset</label></li>
</ul>
<p><strong>2. Instrumental Variable Strategy</strong></p>
<p>Validate the multi-stage instrumental variable approach:</p>
<ul>
<li><label><input type="checkbox" checked="">Confirm that the 1st-stage uses <strong>predicted PV</strong> from the 0th-stage (not raw PV)</label></li>
<li>This ensures a clean identification chain: GR → PV → BEV → Health</li>
</ul>
<p><strong>3. Nonlinear Relationships</strong></p>
<p>Account for potential nonlinearities in the relationships:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked=""><strong>0th-stage enhancement</strong>: Add quadratic term <strong>gr_by_year²</strong> to capture diminishing returns in solar panel installation</label></li>
<li><label><input type="checkbox" checked=""><strong>1st-stage enhancement</strong>: Add quadratic term <strong>PV²</strong> using predicted values to allow for nonlinear effects of infrastructure on adoption</label></li>
</ul>
<p><strong>4. Fixed Effects Specification</strong></p>
<p>Control for unobserved heterogeneity:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Include <strong>State × Year</strong> fixed effects to absorb:</label>
<ul>
<li>State-specific policy changes (e.g., EV subsidies, emissions regulations)</li>
<li>Regional economic shocks</li>
<li>Healthcare system differences across states</li>
</ul></li>
</ul>
<p><strong>5. Heterogeneity Analysis</strong></p>
<p>Examine effect heterogeneity across different contexts:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Estimate models separately for:</label>
<ul>
<li><strong>District type</strong>: Rural districts (Landkreise) vs.&nbsp;Urban districts (Kreisfreie Städte)</li>
<li><strong>Geography</strong>: Western states (Old Bundesländer) vs.&nbsp;Eastern states (New Bundesländer)</li>
</ul></li>
</ul>
<p>This reveals whether EV health effects differ by urbanization and regional characteristics.</p>
<p><strong>6. Control Variables</strong></p>
<p>Include additional covariates to reduce omitted variable bias:</p>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Verify availability of <strong>GDP per capita (t-1)</strong> in dataset</label></li>
<li><label><input type="checkbox" checked="">Include GDP in 1st and 2nd stages to control for economic development</label></li>
<li><label><input type="checkbox">Consider additional controls (if data available):</label>
<ul>
<li>Physician density (healthcare access)</li>
<li>Population age structure (health needs)</li>
</ul></li>
</ul>
<p><em>Note: Some factors may be absorbed by district fixed effects.</em></p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This notebook analyzes the causal effect of battery electric vehicle (BEV) adoption on health outcomes in Germany using administrative data from 2016-2023. We employ an instrumental variables strategy that exploits exogenous variation in solar radiation to identify the health impacts of EV adoption.</p>
<p><strong>Research Question</strong>: Do regions with higher BEV adoption rates experience improved health outcomes, as measured by hospitalization rates?</p>
<p><strong>Identification Strategy</strong>: We use a multi-stage instrumental variables approach where solar radiation affects charging infrastructure deployment, which in turn affects BEV adoption. This provides plausibly exogenous variation in EV adoption that is uncorrelated with unobserved determinants of health.</p>
</section>
<section id="data-loading" class="level1">
<h1>Data Loading</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">root.dir =</span> <span class="st">"../../"</span>)  <span class="co"># Set working directory to project root</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Data manipulation and visualization</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)  <span class="co"># Create animated plots</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)      <span class="co"># Read/write Parquet files</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)         <span class="co"># Spatial data handling</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)      <span class="co"># Read Stata files</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lfe)        <span class="co"># Linear fixed effects models with instrumental variables</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)     <span class="co"># Professional regression table formatting</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-preparation" class="level1">
<h1>Data Preparation</h1>
<p>This section loads and prepares three key datasets: BEV adoption, health outcomes, and geographic boundaries.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## BEV Data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load battery electric vehicle (BEV) adoption data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: German Federal Motor Transport Authority (Kraftfahrt-Bundesamt)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Coverage: All German districts (Kreise), 2016-2023</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>bev_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/Germany/raw/BEV_health.dta"</span>, <span class="at">col_select =</span> <span class="fu">c</span>(AGS, year, gr_by_year, BEV_share, LF_PV, pop_total, average_age, GDP_per_capita))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and prepare BEV data</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>bev_data <span class="ot">&lt;-</span> bev_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(AGS <span class="sc">&gt;=</span> <span class="dv">1000</span>, AGS <span class="sc">&lt;=</span> <span class="dv">99999</span>) <span class="sc">%&gt;%</span>  <span class="co"># Keep only valid district codes (excludes aggregated regions)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">c</span>(AGS, year, pop_total, GDP_per_capita), as.integer),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">PV_l1 =</span> LF_PV,  <span class="co"># LF_PV = Ladeinfrastruktur (charging points), already lagged by 1 year</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">gr =</span> gr_by_year  <span class="co"># gr = Global radiation (instrument for solar panel installation)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Save processed data for faster loading in future sessions</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># bev_data %&gt;% write_parquet("data/Germany/bev_data.parquet")</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Health Data</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Load hospitalization data from German Federal Statistical Office (Destatis)</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: Hospital statistics (Krankenhausstatistik), Table 23131-01-01-4</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Coverage: All hospital admissions by district, year, age group, and ICD-10 diagnosis</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>health_data_raw <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/Germany/raw/23131-01-01-4.csv"</span>, <span class="at">skip =</span> <span class="dv">7</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"ISO-8859-1"</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and reshape health data</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on two outcomes: all-cause hospitalizations and respiratory disease hospitalizations</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>health_data <span class="ot">&lt;-</span> health_data_raw <span class="sc">%&gt;%</span> </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">year =</span> ...<span class="dv">1</span>, <span class="at">AGS =</span> ...<span class="dv">2</span>, <span class="at">age =</span> ...<span class="dv">4</span>) <span class="sc">%&gt;%</span>  <span class="co"># Rename automatically generated column names</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">3</span>) <span class="sc">%&gt;%</span>  <span class="co"># Remove redundant district name column</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(AGS, <span class="st">"[A-Za-z]"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># Remove rows with text codes (aggregate statistics)</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract key variables</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(age <span class="sc">==</span> <span class="st">"Insgesamt"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Focus on all ages combined</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        year, AGS, </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">patients_all =</span> insgesamt,  <span class="co"># Total hospitalizations (all diagnoses)</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">patients_resp =</span> <span class="st">`</span><span class="at">J00-J99 Krankheiten des  Atmungssystems</span><span class="st">`</span>  <span class="co"># Respiratory diseases (ICD-10: J00-J99)</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">c</span>(year, AGS, <span class="fu">starts_with</span>(<span class="st">"patients"</span>)), as.integer),</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Harmonize district codes for city-states (have different coding conventions)</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">AGS =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            AGS <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="dv">11000</span>,  <span class="co"># Berlin</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            AGS <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2000</span>,    <span class="co"># Hamburg</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> AGS</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(AGS <span class="sc">&gt;=</span> <span class="dv">1000</span>, AGS <span class="sc">&lt;=</span> <span class="dv">99999</span>)  <span class="co"># Keep only valid district codes</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Save processed health data</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co"># health_data %&gt;% write_parquet("data/Germany/health_data.parquet")</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="do">## Geographic Data</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Load district boundary shapefile</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: Federal Agency for Cartography and Geodesy (BKG)</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co"># VG5000 = Administrative areas (Verwaltungsgebiete) at 1:5,000,000 scale</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/Germany/raw/vg5000_12-31.gk3.shape.ebenen/vg5000_ebenen_1231/VG5000_KRS.shp"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AGS =</span> <span class="fu">as.integer</span>(AGS)) <span class="sc">%&gt;%</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(AGS, GEN, BEZ, geometry) <span class="sc">%&gt;%</span>  <span class="co"># Keep: district code, name, type, geometry</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract state from district code (first 1-2 digits)</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">state =</span> AGS <span class="sc">%/%</span> <span class="dv">1000</span>,</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Map state codes to names</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Schleswig-Holstein"</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Hamburg"</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Niedersachsen"</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Bremen"</span>,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Nordrhein-Westfalen"</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Hessen"</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Rheinland-Pfalz"</span>,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Baden-Württemberg"</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Bayern"</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Saarland"</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Berlin"</span>,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Brandenburg"</span>,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">13</span> <span class="sc">~</span> <span class="st">"Mecklenburg-Vorpommern"</span>,</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">14</span> <span class="sc">~</span> <span class="st">"Sachsen"</span>,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">"Sachsen-Anhalt"</span>,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>            state <span class="sc">==</span> <span class="dv">16</span> <span class="sc">~</span> <span class="st">"Thüringen"</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">c</span>(BEZ, GEN, state), as_factor),</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create indicator variables for heterogeneity analysis</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">CITY =</span> (BEZ <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Kreisfreie Stadt"</span>, <span class="st">"Stadtkreis"</span>)),  <span class="co"># Urban district indicator</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">NEU =</span> AGS <span class="sc">&gt;=</span> <span class="dv">12000</span>  <span class="co"># East Germany indicator (new federal states, post-reunification)</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="data-validation" class="level2">
<h2 class="anchored" data-anchor-id="data-validation">Data Validation</h2>
<p>Verify data quality and consistency across datasets.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## BEV Data Validation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check coverage: Number of unique districts in BEV data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>bev_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(AGS) <span class="sc">%&gt;%</span> <span class="fu">n_distinct</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 434</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected: ~400 districts (Germany has 401 districts as of 2023)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify mismatches: Districts in BEV data but not in map</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(bev_data, map_data, <span class="at">by =</span> <span class="st">"AGS"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> <span class="fu">select</span>(AGS) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 1
     AGS
   &lt;int&gt;
 1  3152
 2  3156
 3  8210
 4  8238
 5  8255
 6  8310
 7  8330
 8  8333
 9  8410
10  8414
# ℹ 23 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> <span class="fu">pull</span>(BEV_share) <span class="sc">%&gt;%</span> <span class="fu">is.na</span>() <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 33 districts with missing BEV_share (100% NA)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretation: These are historical districts that were merged/reorganized</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Health Data Validation</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check coverage: Number of unique districts in health data</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>health_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(AGS) <span class="sc">%&gt;%</span> <span class="fu">n_distinct</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 473</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected: More than current count due to historical districts</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify mismatches: Districts in health data but not in map</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(health_data, map_data, <span class="at">by =</span> <span class="st">"AGS"</span>) </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> <span class="fu">select</span>(AGS) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 1
     AGS
   &lt;dbl&gt;
 1  3152
 2  3156
 3  5354
 4 13001
 5 13002
 6 13005
 7 13006
 8 13051
 9 13052
10 13053
# ℹ 62 more rows</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> <span class="fu">pull</span>(patients_all) <span class="sc">%&gt;%</span> <span class="fu">is.na</span>() <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 72 districts with missing patient counts (100% NA)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretation: Historical districts from earlier years before reorganization</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Reverse Validation: Check for Missing Current Districts</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">## BEV Data Completeness</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify all current districts have BEV data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(map_data, bev_data, <span class="at">by =</span> <span class="st">"AGS"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 6 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: DHDN / 3-degree Gauss-Kruger zone 3
[1] AGS      GEN      BEZ      state    CITY     NEU      geometry
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 0 missing districts ✓</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All current districts are covered in BEV data</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Health Data Completeness</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify all current districts have health data</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(map_data, health_data, <span class="at">by =</span> <span class="st">"AGS"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 6 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: DHDN / 3-degree Gauss-Kruger zone 3
[1] AGS      GEN      BEZ      state    CITY     NEU      geometry
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Result: 0 missing districts ✓</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All current districts are covered in health data</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Spatial-Temporal Visualization</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create animated choropleth map showing BEV adoption trends</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose: Identify spatial patterns and diffusion of EV adoption</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>animation_bev <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bev_data, map_data, <span class="at">by =</span> <span class="st">"AGS"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, AGS) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">geometry =</span> geometry, <span class="at">fill =</span> BEV_share, <span class="at">group =</span> AGS)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">option =</span> <span class="st">"plasma"</span>, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">transform =</span> scales<span class="sc">::</span><span class="fu">transform_asinh</span>()  <span class="co"># Asinh transformation handles zeros and skewness better than log</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">'Year: {frame_time}'</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"BEV Share (%)"</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">transition_time</span>(year)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Render and save animation (800x600 px at 100 DPI)</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(animation_bev, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">res =</span> <span class="dv">100</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"outputs/figures/germany_bev_share.gif"</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">res =</span> <span class="dv">100</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create animated map showing hospitalization rates</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose: Visualize health outcome variation across space and time</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>animation_patients <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    health_data,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    map_data,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"AGS"</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        bev_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(AGS, year, pop_total),</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"AGS"</span>, <span class="st">"year"</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">patients_all_per_1000 =</span> (patients_all <span class="sc">/</span> pop_total) <span class="sc">*</span> <span class="dv">1000</span>  <span class="co"># Standardize by population</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">geometry =</span> geometry, <span class="at">fill =</span> patients_all_per_1000, <span class="at">group =</span> AGS)) <span class="sc">+</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">option =</span> <span class="st">"plasma"</span>, </span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">transform =</span> scales<span class="sc">::</span><span class="fu">transform_asinh</span>()</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">'Year: {frame_time}'</span>,</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"Patients</span><span class="sc">\n</span><span class="st">per 1,000"</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">transition_time</span>(year)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(animation_patients, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">res =</span> <span class="dv">100</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"outputs/figures/germany_patients.gif"</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">res =</span> <span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-data" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/germany_bev_share.gif" class="img-fluid figure-img"></p>
<figcaption>BEV share evolution across German districts. Darker colors indicate higher EV adoption rates.</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/germany_patients.gif" class="img-fluid figure-img"></p>
<figcaption>All-cause hospitalization rates per 1,000 population. Spatial and temporal variation provides context for regression analysis.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate time series: National hospitalization trends</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose: Identify secular trends and potential structural breaks (e.g., COVID-19)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>health_data <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_patients =</span> <span class="fu">sum</span>(patients_all, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_patients)) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Total Patients"</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="germany_experiments_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Total All-Cause Hospitalizations in Germany by Year. The sharp drop in 2020 reflects COVID-19 pandemic effects on healthcare utilization.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="merge-and-lag-structure" class="level2">
<h2 class="anchored" data-anchor-id="merge-and-lag-structure">Merge and Lag Structure</h2>
<p>Combine datasets and create appropriate lag structure for analysis.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create lags and leads for panel data analysis</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Handles pre-lagged variables (e.g., PV_l1) by reconstructing base variable first</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   data: Panel dataset with group_var and order_var</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   vars: Variable names to lag/lead (can include pre-lagged variables like "PV_l1")</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   n_lags: Number of lags to create (default: 5)</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   n_leads: Number of leads to create (default: 5)</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_var: Panel identifier (default: "AGS")</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   order_var: Time variable (default: "year")</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns:</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   Dataset with original variables plus:</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     - {var}_lX: X-period lag</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     - {var}_fX: X-period lead</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     - For pre-lagged inputs like "PV_l1", also creates base variable "PV"</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>create_lags_leads <span class="ot">&lt;-</span> <span class="cf">function</span>(data, vars, <span class="at">n_lags =</span> <span class="dv">5</span>, <span class="at">n_leads =</span> <span class="dv">5</span>, <span class="at">group_var =</span> <span class="st">"AGS"</span>, <span class="at">order_var =</span> <span class="st">"year"</span>) {</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="sc">!!</span><span class="fu">sym</span>(group_var), <span class="sc">!!</span><span class="fu">sym</span>(order_var))  <span class="co"># Ensure proper temporal ordering</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (var <span class="cf">in</span> vars) {</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Detect and handle pre-lagged variables (e.g., PV_l1)</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        existing_lag <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        base_var <span class="ot">&lt;-</span> var</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"_l[0-9]+$"</span>, var)) {</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract existing lag number</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            existing_lag <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">".*_l([0-9]+)$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var))</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove lag suffix to get base variable name</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>            base_var <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_l[0-9]+$"</span>, <span class="st">""</span>, var)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reconstruct base variable by taking appropriate lead</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Example: PV_l1 at time t represents PV at t-1</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">#          Therefore, lead(PV_l1, 1) gives PV at t</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(group_var)) <span class="sc">%&gt;%</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">base_var :=</span> <span class="fu">lead</span>(<span class="sc">!!</span><span class="fu">sym</span>(var), <span class="at">n =</span> existing_lag)) <span class="sc">%&gt;%</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ungroup</span>()</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>        var_to_use <span class="ot">&lt;-</span> base_var</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create lag structure: var_l1, var_l2, ..., var_lN</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_lags) {</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>            lag_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(var_to_use, <span class="st">"_l"</span>, i)</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(group_var)) <span class="sc">%&gt;%</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">lag_name :=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(var_to_use), <span class="at">n =</span> i)) <span class="sc">%&gt;%</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ungroup</span>()</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create lead structure: var_f1, var_f2, ..., var_fN</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Useful for placebo tests and checking parallel trends</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_leads) {</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>            lead_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(var_to_use, <span class="st">"_f"</span>, i)</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>            result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(group_var)) <span class="sc">%&gt;%</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">lead_name :=</span> <span class="fu">lead</span>(<span class="sc">!!</span><span class="fu">sym</span>(var_to_use), <span class="at">n =</span> i)) <span class="sc">%&gt;%</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ungroup</span>()</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result)</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge all datasets and create analysis variables</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>merged <span class="ot">&lt;-</span> bev_data <span class="sc">%&gt;%</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">full_join</span>(health_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"AGS"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(map_data <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>(), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"AGS"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create population-standardized health outcomes (per 1,000 residents)</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"patients"</span>), <span class="sc">~</span> (.x <span class="sc">/</span> pop_total) <span class="sc">*</span> <span class="dv">1000</span>, <span class="at">.names =</span> <span class="st">"{.col}_per_1000"</span>), </span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create state × year fixed effect identifier</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">stateyear =</span> <span class="fu">as_factor</span>(<span class="fu">paste0</span>(state, <span class="st">"_"</span>, year))</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply lag structure to key variables</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates variables like: patients_all_per_1000_l1, BEV_share_l2, PV (from PV_l1), etc.</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>merged <span class="ot">&lt;-</span> <span class="fu">create_lags_leads</span>(</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>    merged, </span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"patients_all_per_1000"</span>, <span class="st">"patients_resp_per_1000"</span>, <span class="st">"BEV_share"</span>, <span class="st">"PV_l1"</span>, <span class="st">"gr"</span>, <span class="st">"GDP_per_capita"</span>),</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_lags =</span> <span class="dv">5</span>,</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_leads =</span> <span class="dv">5</span>,</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_var =</span> <span class="st">"AGS"</span>,</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">order_var =</span> <span class="st">"year"</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="twfe-and-2sls-estimates" class="level2">
<h2 class="anchored" data-anchor-id="twfe-and-2sls-estimates">TWFE and 2SLS Estimates</h2>
<p>We estimate two sets of models:</p>
<ol type="1">
<li><strong>Two-Way Fixed Effects (TWFE)</strong>: Standard OLS with district and state×year fixed effects
<ul>
<li>Identifies within-district variation in BEV adoption and health</li>
<li>May suffer from endogeneity bias if unobserved factors affect both EVs and health</li>
</ul></li>
<li><strong>Two-Stage Least Squares (2SLS)</strong>: Instrumental variables approach
<ul>
<li>Uses charging infrastructure (instrumented by solar radiation) to predict BEV adoption</li>
<li>Provides causal estimates under instrument validity assumptions</li>
</ul></li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## All-Cause Hospitalizations</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># TWFE: Standard panel regression with two-way fixed effects</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Specification: Y_it = β·BEV_{i,t-1} + α_i + γ_{st} + ε_it</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># where α_i = district FE, γ_{st} = state×year FE</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>twfe_all <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2SLS: Instrumental variables regression</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># First stage: BEV_{i,t-1} = π·PV_{i,t-1} + α_i + γ_{st} + u_it</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Second stage: Y_it = β·BEV_hat_{i,t-1} + α_i + γ_{st} + ε_it</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Instrument: Charging infrastructure (PV) affects BEV adoption but not health directly</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>tsls_all <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co"># First stage: Check instrument strength</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co"># F-statistic should be &gt; 10 (Stock &amp; Yogo rule of thumb)</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>first_stage_all <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Respiratory Disease Hospitalizations</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Same specifications as above, but for respiratory outcomes (ICD-10: J00-J99)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rationale: If EVs reduce air pollution, respiratory diseases should show larger effects</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># TWFE for respiratory diseases</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>twfe_resp <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2SLS for respiratory diseases</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>tsls_resp <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># First stage (same as above, shown for completeness)</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>first_stage_resp <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-tbl-cap="Main Regression Results: Effect of BEV Adoption on Hospitalizations. Columns 1-3 show results for all-cause hospitalizations; columns 4-6 show respiratory disease hospitalizations. TWFE estimates may be biased by endogeneity; 2SLS provides causal estimates under instrument validity. All specifications include district fixed effects (AGS) and state×year fixed effects. Standard errors clustered by state and year.">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display regression results in professional table format</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TWFE"</span> <span class="ot">=</span> twfe_all,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1st Stage"</span> <span class="ot">=</span> first_stage_all,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2SLS"</span> <span class="ot">=</span> tsls_all,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TWFE"</span> <span class="ot">=</span> twfe_resp,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1st Stage"</span> <span class="ot">=</span> first_stage_resp,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2SLS"</span> <span class="ot">=</span> tsls_resp</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.header =</span> <span class="fu">list</span>(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"All Causes"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Respiratory Diseases"</span> <span class="ot">=</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.rsquared =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.adjrs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.fstatistic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th>
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="3">
All Causes
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="3">
Respiratory Diseases
</th>
</tr>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
TWFE
</th>
<th style="padding-left: 5px;padding-right: 5px;">
1st Stage
</th>
<th style="padding-left: 5px;padding-right: 5px;">
2SLS
</th>
<th style="padding-left: 5px;padding-right: 5px;">
TWFE
</th>
<th style="padding-left: 5px;padding-right: 5px;">
1st Stage
</th>
<th style="padding-left: 5px;padding-right: 5px;">
2SLS
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
BEV_share_l1
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2.36157
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.12319
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.15331)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.08788)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
PV_l1
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.08856
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.08856
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.03682)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.03682)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
<code>BEV_share_l1(fit)</code>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
4.33569
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.12767
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(7.48357)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.00098)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1998
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2398
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1998
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2398
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (full model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
216.27925
</td>
<td style="padding-left: 5px;padding-right: 5px;">
38.79107
</td>
<td style="padding-left: 5px;padding-right: 5px;">
214.66022
</td>
<td style="padding-left: 5px;padding-right: 5px;">
69.73248
</td>
<td style="padding-left: 5px;padding-right: 5px;">
38.79107
</td>
<td style="padding-left: 5px;padding-right: 5px;">
69.72790
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (full model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (proj model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
4.19282
</td>
<td style="padding-left: 5px;padding-right: 5px;">
5.78427
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.33566
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1.96513
</td>
<td style="padding-left: 5px;padding-right: 5px;">
5.78427
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.01627
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (proj model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.04060
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.01617
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.56235
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.16097
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.01617
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.89851
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: AGS
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: stateyear
</td>
<td style="padding-left: 5px;padding-right: 5px;">
80
</td>
<td style="padding-left: 5px;padding-right: 5px;">
96
</td>
<td style="padding-left: 5px;padding-right: 5px;">
80
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
96
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="7">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
<section id="lag-structure-analysis" class="level3">
<h3 class="anchored" data-anchor-id="lag-structure-analysis">Lag Structure Analysis</h3>
<p>Test robustness of results to different lag specifications. This helps identify the appropriate timing of effects and rules out spurious correlations.</p>
<section id="first-stage-instrument-strength-across-lags" class="level4">
<h4 class="anchored" data-anchor-id="first-stage-instrument-strength-across-lags">First Stage: Instrument Strength Across Lags</h4>
<div class="cell" data-tbl-cap="First Stage Regression: Testing Instrument Strength Across Different Lag Specifications. All specifications include district fixed effects (AGS) and state×year fixed effects. Standard errors clustered by state and year. F-statistics test for weak instruments (should exceed 10).">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test how instrument strength varies with lag of charging infrastructure</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Question: Does PV at t, t-1, t-2, or t-3 best predict BEV adoption at t-1?</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># All causes</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>fs_all_pv <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>fs_all_pv_l1 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>fs_all_pv_l2 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l2 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>fs_all_pv_l3 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l3 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(0)"</span> <span class="ot">=</span> fs_all_pv,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1)"</span> <span class="ot">=</span> fs_all_pv_l1,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2)"</span> <span class="ot">=</span> fs_all_pv_l2,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(3)"</span> <span class="ot">=</span> fs_all_pv_l3</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.header =</span> <span class="fu">list</span>(</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BEV_l1"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.rsquared =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.adjrs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.fstatistic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th>
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="4">
BEV_l1
</th>
</tr>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(0)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(3)
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
PV
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.07582
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.03324)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
PV_l1
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.08856
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.03682)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
PV_l2
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.09780
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.05283)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
PV_l3
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.10136
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.07283)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1998
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2398
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2797
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2796
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (full model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
19.88621
</td>
<td style="padding-left: 5px;padding-right: 5px;">
38.79107
</td>
<td style="padding-left: 5px;padding-right: 5px;">
54.74779
</td>
<td style="padding-left: 5px;padding-right: 5px;">
54.23667
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (full model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (proj model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
5.20433
</td>
<td style="padding-left: 5px;padding-right: 5px;">
5.78427
</td>
<td style="padding-left: 5px;padding-right: 5px;">
3.42670
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1.93699
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (proj model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.02253
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.01617
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.06415
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.16400
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: AGS
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: stateyear
</td>
<td style="padding-left: 5px;padding-right: 5px;">
80
</td>
<td style="padding-left: 5px;padding-right: 5px;">
96
</td>
<td style="padding-left: 5px;padding-right: 5px;">
112
</td>
<td style="padding-left: 5px;padding-right: 5px;">
112
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="5">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
</section>
<section id="twfe-effect-timing" class="level4">
<h4 class="anchored" data-anchor-id="twfe-effect-timing">TWFE: Effect Timing</h4>
<div class="cell" data-tbl-cap="TWFE Estimates: Testing Effect Timing Across Different BEV Lag Specifications. All specifications include district fixed effects (AGS) and state×year fixed effects. Standard errors clustered by state and year. Comparing coefficients across lags helps identify the appropriate temporal structure of health effects.">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test how effects vary with lag of BEV adoption</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Question: Do current, 1-year lagged, 2-year lagged, or 3-year lagged BEV shares predict current health?</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Expectation: Effects should appear with 1-2 year lag if air quality improvements drive health gains</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># All causes - varying BEV lags</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>twfe_all_ <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>twfe_all_l1 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>twfe_all_l2 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share_l2 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>twfe_all_l3 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share_l3 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Respiratory - varying BEV lags</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>twfe_resp_ <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>twfe_resp_l1 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>twfe_resp_l2 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share_l2 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>twfe_resp_l3 <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share_l3 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(0)"</span> <span class="ot">=</span> twfe_all_,</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1)"</span> <span class="ot">=</span> twfe_all_l1,</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2)"</span> <span class="ot">=</span> twfe_all_l2,</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(3)"</span> <span class="ot">=</span> twfe_all_l3,</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(0)"</span> <span class="ot">=</span> twfe_resp_,</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1)"</span> <span class="ot">=</span> twfe_resp_l1,</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2)"</span> <span class="ot">=</span> twfe_resp_l2,</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(3)"</span> <span class="ot">=</span> twfe_resp_l3</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.header =</span> <span class="fu">list</span>(</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"All Causes"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Respiratory Diseases"</span> <span class="ot">=</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.rsquared =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.adjrs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.fstatistic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">4</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th>
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="4">
All Causes
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="4">
Respiratory Diseases
</th>
</tr>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(0)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(3)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(0)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(3)
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
BEV_share
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1.8632
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0527
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.0926)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.0848)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
BEV_share_l1
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2.3616
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.1232
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.1533)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.0879)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
BEV_share_l2
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.5550
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.0218
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.2258)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.1069)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
BEV_share_l3
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-1.1485
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0735
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.3537)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.0980)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2398
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1998
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1598
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1198
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2362
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1574
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1180
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (full model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
249.7853
</td>
<td style="padding-left: 5px;padding-right: 5px;">
216.2793
</td>
<td style="padding-left: 5px;padding-right: 5px;">
174.6988
</td>
<td style="padding-left: 5px;padding-right: 5px;">
155.3688
</td>
<td style="padding-left: 5px;padding-right: 5px;">
81.5785
</td>
<td style="padding-left: 5px;padding-right: 5px;">
69.7325
</td>
<td style="padding-left: 5px;padding-right: 5px;">
54.4675
</td>
<td style="padding-left: 5px;padding-right: 5px;">
41.4192
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (full model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0000
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (proj model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2.9080
</td>
<td style="padding-left: 5px;padding-right: 5px;">
4.1928
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.2050
</td>
<td style="padding-left: 5px;padding-right: 5px;">
10.5433
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.3871
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1.9651
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0415
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.5630
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (proj model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0881
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0406
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.6507
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.0012
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.5338
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.1610
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.8385
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.4530
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: AGS
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: stateyear
</td>
<td style="padding-left: 5px;padding-right: 5px;">
96
</td>
<td style="padding-left: 5px;padding-right: 5px;">
80
</td>
<td style="padding-left: 5px;padding-right: 5px;">
64
</td>
<td style="padding-left: 5px;padding-right: 5px;">
48
</td>
<td style="padding-left: 5px;padding-right: 5px;">
90
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
60
</td>
<td style="padding-left: 5px;padding-right: 5px;">
45
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="9">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
</section>
</section>
<section id="pre-covid-analysis" class="level3">
<h3 class="anchored" data-anchor-id="pre-covid-analysis">Pre-COVID Analysis</h3>
<p>The COVID-19 pandemic (2020-2023) dramatically affected healthcare utilization and reporting. We re-estimate our models on pre-pandemic data to ensure results are not driven by COVID-related confounders.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict sample to 2016-2019 (pre-pandemic period)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>merged_precovid <span class="ot">&lt;-</span> merged <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">2020</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pre-covid-all-causes" class="level3">
<h3 class="anchored" data-anchor-id="pre-covid-all-causes">Pre-COVID: All Causes</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-estimate main specifications on pre-pandemic sample</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>twfe_all_pre <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_precovid</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>first_stage_all_pre <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_precovid</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>tsls_all_pre <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_precovid</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pre-covid-respiratory-diseases" class="level3">
<h3 class="anchored" data-anchor-id="pre-covid-respiratory-diseases">Pre-COVID: Respiratory Diseases</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-estimate respiratory models on pre-pandemic sample</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>twfe_resp_pre <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_precovid</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>first_stage_resp_pre <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    BEV_share_l1 <span class="sc">~</span> PV_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_precovid</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>tsls_resp_pre <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_precovid</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="pre-covid-results-comparison" class="level3">
<h3 class="anchored" data-anchor-id="pre-covid-results-comparison">Pre-COVID Results Comparison</h3>
<div class="cell" data-tbl-cap="Pre-COVID Analysis: Regression Results for 2016-2019. Excluding the pandemic period provides estimates free from COVID-19 confounding. All specifications include district fixed effects (AGS) and state×year fixed effects. Standard errors clustered by state and year. Compare with full-sample results to assess robustness.">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TWFE"</span> <span class="ot">=</span> twfe_all_pre,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1st Stage"</span> <span class="ot">=</span> first_stage_all_pre,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2SLS"</span> <span class="ot">=</span> tsls_all_pre,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TWFE"</span> <span class="ot">=</span> twfe_resp_pre,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1st Stage"</span> <span class="ot">=</span> first_stage_resp_pre,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2SLS"</span> <span class="ot">=</span> tsls_resp_pre</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.header =</span> <span class="fu">list</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"All Causes (Pre-COVID)"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Respiratory (Pre-COVID)"</span> <span class="ot">=</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.rsquared =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.adjrs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.fstatistic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th>
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="3">
All Causes (Pre-COVID)
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="3">
Respiratory (Pre-COVID)
</th>
</tr>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
TWFE
</th>
<th style="padding-left: 5px;padding-right: 5px;">
1st Stage
</th>
<th style="padding-left: 5px;padding-right: 5px;">
2SLS
</th>
<th style="padding-left: 5px;padding-right: 5px;">
TWFE
</th>
<th style="padding-left: 5px;padding-right: 5px;">
1st Stage
</th>
<th style="padding-left: 5px;padding-right: 5px;">
2SLS
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
BEV_share_l1
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-1.41816
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1.27537
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(2.62176)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.43103)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
PV_l1
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.00934
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.00934
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.01788)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.01788)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
<code>BEV_share_l1(fit)</code>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
35.36514
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
27.15374
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(165.68891)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(89.43970)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
800
</td>
<td style="padding-left: 5px;padding-right: 5px;">
800
</td>
<td style="padding-left: 5px;padding-right: 5px;">
800
</td>
<td style="padding-left: 5px;padding-right: 5px;">
788
</td>
<td style="padding-left: 5px;padding-right: 5px;">
800
</td>
<td style="padding-left: 5px;padding-right: 5px;">
788
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (full model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
212.36870
</td>
<td style="padding-left: 5px;padding-right: 5px;">
11.23895
</td>
<td style="padding-left: 5px;padding-right: 5px;">
189.05169
</td>
<td style="padding-left: 5px;padding-right: 5px;">
57.18900
</td>
<td style="padding-left: 5px;padding-right: 5px;">
11.23895
</td>
<td style="padding-left: 5px;padding-right: 5px;">
16.78074
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (full model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (proj model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.29259
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.27307
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.04556
</td>
<td style="padding-left: 5px;padding-right: 5px;">
8.75517
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.27307
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.09217
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (proj model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.58856
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.60128
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.83098
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00309
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.60128
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.76143
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: AGS
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: stateyear
</td>
<td style="padding-left: 5px;padding-right: 5px;">
32
</td>
<td style="padding-left: 5px;padding-right: 5px;">
32
</td>
<td style="padding-left: 5px;padding-right: 5px;">
32
</td>
<td style="padding-left: 5px;padding-right: 5px;">
30
</td>
<td style="padding-left: 5px;padding-right: 5px;">
32
</td>
<td style="padding-left: 5px;padding-right: 5px;">
30
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="7">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
</section>
<section id="heterogeneity-analysis-sample-splits" class="level3">
<h3 class="anchored" data-anchor-id="heterogeneity-analysis-sample-splits">Heterogeneity Analysis: Sample Splits</h3>
<p>Examine whether effects differ across geographic and urban/rural contexts. This reveals policy-relevant heterogeneity and tests whether results are driven by specific subgroups.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utility functions for visualization with extreme value handling</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Signed log10 transformation: Compresses large positive and negative values</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula: sign(x) × log10(|x| + 1)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Useful for visualizing coefficients that span multiple orders of magnitude</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>signed_log10 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sign</span>(x) <span class="sc">*</span> <span class="fu">log10</span>(<span class="fu">abs</span>(x) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse of signed log10 for axis labels</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>signed_log10_inv <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sign</span>(x) <span class="sc">*</span> (<span class="dv">10</span><span class="sc">^</span><span class="fu">abs</span>(x) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to estimate 2SLS on subsamples defined by a grouping variable</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters:</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   data: Full dataset</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_var: Variable defining subgroups (e.g., "state", "CITY")</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   outcome_var: Dependent variable</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns: Tibble with coefficient, standard error, and confidence interval for each subgroup</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>run_subsample_tsls <span class="ot">&lt;-</span> <span class="cf">function</span>(data, group_var, <span class="at">outcome_var =</span> <span class="st">"patients_all_per_1000"</span>) {</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get unique levels of grouping variable</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    levels <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(<span class="sc">!!</span><span class="fu">sym</span>(group_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>()</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each subgroup</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (level <span class="cf">in</span> levels) {</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter data</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        subsample <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(group_var) <span class="sc">==</span> level)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estimate 2SLS model with district FE, state×year FE</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Cluster standard errors by district and year</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">felm</span>(</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">formula =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(outcome_var, <span class="st">" ~ 1 | AGS + stateyear | (BEV_share_l1 ~ PV_l1) | AGS + year"</span>)),</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> subsample</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract coefficient and compute 95% confidence interval</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(model)) {</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>            coef_val <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="st">"`BEV_share_l1(fit)`"</span>]</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>            se_val <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(model)))[<span class="st">"`BEV_share_l1(fit)`"</span>]</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>            n_obs <span class="ot">&lt;-</span> <span class="fu">nobs</span>(model)</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>            results[[<span class="fu">as.character</span>(level)]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> group_var,</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">level =</span> <span class="fu">as.character</span>(level),</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">coefficient =</span> coef_val,</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>                <span class="at">se =</span> se_val,</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>                <span class="at">ci_lower =</span> coef_val <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se_val,</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>                <span class="at">ci_upper =</span> coef_val <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se_val,</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_obs =</span> n_obs</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(results)</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Run subsample analysis for three dimensions of heterogeneity</span></span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a><span class="co"># All-cause hospitalizations</span></span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>subsample_results_all_state <span class="ot">&lt;-</span> <span class="fu">run_subsample_tsls</span>(merged, <span class="st">"state"</span>, <span class="st">"patients_all_per_1000"</span>)</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>subsample_results_all_city <span class="ot">&lt;-</span> <span class="fu">run_subsample_tsls</span>(merged, <span class="st">"CITY"</span>, <span class="st">"patients_all_per_1000"</span>)</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>subsample_results_all_neu <span class="ot">&lt;-</span> <span class="fu">run_subsample_tsls</span>(merged, <span class="st">"NEU"</span>, <span class="st">"patients_all_per_1000"</span>)</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Respiratory hospitalizations</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>subsample_results_resp_state <span class="ot">&lt;-</span> <span class="fu">run_subsample_tsls</span>(merged, <span class="st">"state"</span>, <span class="st">"patients_resp_per_1000"</span>)</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>subsample_results_resp_city <span class="ot">&lt;-</span> <span class="fu">run_subsample_tsls</span>(merged, <span class="st">"CITY"</span>, <span class="st">"patients_resp_per_1000"</span>)</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>subsample_results_resp_neu <span class="ot">&lt;-</span> <span class="fu">run_subsample_tsls</span>(merged, <span class="st">"NEU"</span>, <span class="st">"patients_resp_per_1000"</span>)</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all results for visualization</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>subsample_results_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>    subsample_results_all_state,</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>    subsample_results_all_city,</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>    subsample_results_all_neu</span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="st">"All Causes"</span>)</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>subsample_results_resp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>    subsample_results_resp_state,</span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a>    subsample_results_resp_city,</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>    subsample_results_resp_neu</span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="st">"Respiratory"</span>)</span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>subsample_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(subsample_results_all, subsample_results_resp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="coefficient-plots-by-state" class="level4">
<h4 class="anchored" data-anchor-id="coefficient-plots-by-state">Coefficient Plots: By State</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize state-level heterogeneity in treatment effects</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Y-axis: Signed log scale to handle extreme coefficients</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate points for all-cause and respiratory outcomes</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>subsample_results <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">level =</span> <span class="fu">fct_reorder</span>(level, coefficient),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome =</span> <span class="fu">factor</span>(outcome, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"All Causes"</span>, <span class="st">"Respiratory"</span>)),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply signed log transformation</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">coef_trans =</span> <span class="fu">signed_log10</span>(coefficient),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ci_lower_trans =</span> <span class="fu">signed_log10</span>(ci_lower),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">ci_upper_trans =</span> <span class="fu">signed_log10</span>(ci_upper)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> coef_trans, <span class="at">color =</span> outcome)) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower_trans, <span class="at">ymax =</span> ci_upper_trans),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">signed_log10</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="sc">-</span><span class="dv">100</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>)),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">round</span>(<span class="fu">signed_log10_inv</span>(x), <span class="dv">0</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"State (Bundesland)"</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Coefficient (patients per 1,000 per 1% BEV share, signed log scale)"</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Outcome"</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="germany_experiments_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Heterogeneous Effects by State: 2SLS estimates of BEV adoption on hospitalizations vary substantially across German states. Coefficients on signed log scale to accommodate wide range. Points show point estimates; error bars show 95% confidence intervals. All estimates include district fixed effects (AGS) and state×year fixed effects; standard errors clustered by district and year.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="coefficient-plots-city-vs.-rural" class="level4">
<h4 class="anchored" data-anchor-id="coefficient-plots-city-vs.-rural">Coefficient Plots: City vs.&nbsp;Rural</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare effects in urban vs. rural districts</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># City = Kreisfreie Stadt or Stadtkreis (independent city)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rural = Landkreis (county)</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>subsample_results <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"CITY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">level =</span> <span class="fu">ifelse</span>(level <span class="sc">==</span> <span class="st">"TRUE"</span>, <span class="st">"City"</span>, <span class="st">"Rural"</span>),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome =</span> <span class="fu">factor</span>(outcome, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"All Causes"</span>, <span class="st">"Respiratory"</span>))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> coefficient, <span class="at">color =</span> outcome)) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper),</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="fl">0.3</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"District Type"</span>,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Coefficient (patients per 1,000 per 1% BEV share)"</span>,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Outcome"</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="germany_experiments_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Urban-Rural Heterogeneity: Comparing 2SLS estimates between urban districts (Kreisfreie Städte/Stadtkreise) and rural districts (Landkreise). Urban areas may show different effects due to higher EV adoption rates, denser populations, and different baseline air quality. All estimates include district fixed effects (AGS) and state×year fixed effects; standard errors clustered by district and year.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="coefficient-plots-east-vs.-west-germany" class="level4">
<h4 class="anchored" data-anchor-id="coefficient-plots-east-vs.-west-germany">Coefficient Plots: East vs.&nbsp;West Germany</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare effects between East and West Germany</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># NEU = TRUE: New federal states (former GDR, joined in 1990)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># NEU = FALSE: Old federal states (former FRG)</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>subsample_results <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"NEU"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">level =</span> <span class="fu">ifelse</span>(level <span class="sc">==</span> <span class="st">"TRUE"</span>, <span class="st">"East Germany (New States)"</span>, <span class="st">"West Germany (Old States)"</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">level =</span> <span class="fu">fct_reorder</span>(level, coefficient),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome =</span> <span class="fu">factor</span>(outcome, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"All Causes"</span>, <span class="st">"Respiratory"</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> coefficient, <span class="at">color =</span> outcome)) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="fl">0.3</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Coefficient (patients per 1,000 per 1% BEV share)"</span>,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Outcome"</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="germany_experiments_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption>East-West Comparison: 2SLS estimates for former East Germany (neue Bundesländer: Brandenburg, Mecklenburg-Vorpommern, Sachsen, Sachsen-Anhalt, Thüringen) vs.&nbsp;former West Germany. Different industrial history, infrastructure, and demographics may generate heterogeneous effects. All estimates include district fixed effects (AGS) and state×year fixed effects; standard errors clustered by district and year.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="multi-stage-iv-adding-0-th-stage" class="level2">
<h2 class="anchored" data-anchor-id="multi-stage-iv-adding-0-th-stage">Multi-Stage IV: Adding 0-th Stage</h2>
<p>Implement a three-stage instrumental variables strategy to strengthen identification:</p>
<ul>
<li><strong>0th stage</strong>: Solar radiation (GR_{t-3}) → Charging infrastructure (PV_{t-2})</li>
<li><strong>1st stage</strong>: Predicted charging infrastructure → BEV adoption (BEV_{t-1})</li>
<li><strong>2nd stage</strong>: Predicted BEV adoption → Health outcomes (Y_t)</li>
</ul>
<p>This approach uses only the component of charging infrastructure driven by exogenous solar radiation variation, providing a cleaner instrument.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict to complete cases for consistent sample across stages</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>merged_chain <span class="ot">&lt;-</span> merged <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        patients_all_per_1000, patients_resp_per_1000, BEV_share_l1, PV_l1, gr_l2</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 0th Stage: Solar Radiation → Charging Infrastructure</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear specification</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>zeroth_stage <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    PV_l1 <span class="sc">~</span> gr_l2 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predicted charging infrastructure from 0th stage</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>merged_chain <span class="ot">&lt;-</span> merged_chain <span class="sc">%&gt;%</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">PV_l1_pred =</span> zeroth_stage<span class="sc">$</span>fitted.values</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 2SLS Chain: Using Predicted Charging Infrastructure</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co"># All-cause hospitalizations</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>tsls_chain <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co"># With quadratic 1st stage (allows nonlinear infrastructure-adoption relationship)</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>tsls_chain_1quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred <span class="sc">+</span> <span class="fu">I</span>(PV_l1_pred<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Respiratory hospitalizations</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>tsls_chain_resp <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>tsls_chain_resp_1quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred <span class="sc">+</span> <span class="fu">I</span>(PV_l1_pred<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 0th Stage with Quadratic: Allow Nonlinear Radiation-Infrastructure Relationship</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic specification (diminishing returns in solar panel installation)</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>zeroth_stage_0quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    PV_l1 <span class="sc">~</span> gr_l2 <span class="sc">+</span> <span class="fu">I</span>(gr_l2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predicted values from quadratic 0th stage</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>merged_chain <span class="ot">&lt;-</span> merged_chain <span class="sc">%&gt;%</span></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">PV_l1_pred_0quadratic =</span> zeroth_stage_0quadratic<span class="sc">$</span>fitted.values</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 2SLS with quadratic 0th stage predictions</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>tsls_chain_0quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred_0quadratic) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>tsls_chain_0quadratic_1quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred_0quadratic <span class="sc">+</span> <span class="fu">I</span>(PV_l1_pred_0quadratic<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>tsls_chain_resp_0quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred_0quadratic) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>tsls_chain_resp_0quadratic_1quadratic <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1_pred_0quadratic <span class="sc">+</span> <span class="fu">I</span>(PV_l1_pred_0quadratic<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged_chain</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell" data-tbl-cap="Multi-Stage IV Results: Testing Nonlinear Specifications. Columns (1)-(2) show 0th stage with linear and quadratic specifications. Columns (1.1.1)-(2.1.2) show all-cause results with different combinations. Columns (1.2.1)-(2.2.2) show respiratory results. Quadratic terms capture potential nonlinearities in radiation→infrastructure and infrastructure→adoption relationships. All specifications include district fixed effects (AGS) and state×year fixed effects. Standard errors clustered by state and year.">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1)"</span> <span class="ot">=</span> zeroth_stage,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2)"</span> <span class="ot">=</span> zeroth_stage_0quadratic,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1.1.1)"</span> <span class="ot">=</span> tsls_chain,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1.1.2)"</span> <span class="ot">=</span> tsls_chain_1quadratic,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2.1.1)"</span> <span class="ot">=</span> tsls_chain_0quadratic,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2.1.2)"</span> <span class="ot">=</span> tsls_chain_0quadratic_1quadratic,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1.2.1)"</span> <span class="ot">=</span> tsls_chain_resp,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(1.2.2)"</span> <span class="ot">=</span> tsls_chain_resp_1quadratic,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2.2.1)"</span> <span class="ot">=</span> tsls_chain_resp_0quadratic,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"(2.2.2)"</span> <span class="ot">=</span> tsls_chain_resp_0quadratic_1quadratic</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.header =</span> <span class="fu">list</span>(</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0-th Stage"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"All Causes 2SLS"</span> <span class="ot">=</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Respiratory 2SLS"</span> <span class="ot">=</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.gof.rows =</span> <span class="fu">list</span>(</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Quadratic 0-th Stage"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"✓"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"✓"</span>, <span class="st">"✓"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"✓"</span>, <span class="st">"✓"</span>),</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Quadratic 1st Stage"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"✓"</span>, <span class="st">""</span>, <span class="st">"✓"</span>, <span class="st">""</span>, <span class="st">"✓"</span>, <span class="st">""</span>, <span class="st">"✓"</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.rsquared =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.adjrs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.fstatistic =</span> <span class="cn">TRUE</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th>
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="2">
0-th Stage
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="4">
All Causes 2SLS
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="4">
Respiratory 2SLS
</th>
</tr>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1.1.1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1.1.2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2.1.1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2.1.2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1.2.1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(1.2.2)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2.2.1)
</th>
<th style="padding-left: 5px;padding-right: 5px;">
(2.2.2)
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
gr_l2
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00070
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.00878
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.00100)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.01336)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
gr_l2^2
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.00001)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
<code>BEV_share_l1(fit)</code>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-5.73419
</td>
<td style="padding-left: 5px;padding-right: 5px;">
12.49652
</td>
<td style="padding-left: 5px;padding-right: 5px;">
9.80623
</td>
<td style="padding-left: 5px;padding-right: 5px;">
15.29337
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-4.30960
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.88429
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1.49449
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.62170
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(16.40694)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(7.58813)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(13.35800)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(7.91547)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(4.31014)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.18614)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(3.08170)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.47701)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Quadratic 0-th Stage
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Quadratic 1st Stage
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (full model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2012.20331
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2010.65513
</td>
<td style="padding-left: 5px;padding-right: 5px;">
192.56231
</td>
<td style="padding-left: 5px;padding-right: 5px;">
181.07136
</td>
<td style="padding-left: 5px;padding-right: 5px;">
195.84407
</td>
<td style="padding-left: 5px;padding-right: 5px;">
164.18034
</td>
<td style="padding-left: 5px;padding-right: 5px;">
25.38931
</td>
<td style="padding-left: 5px;padding-right: 5px;">
63.95907
</td>
<td style="padding-left: 5px;padding-right: 5px;">
59.74279
</td>
<td style="padding-left: 5px;padding-right: 5px;">
68.22245
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (full model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (proj model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.48514
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.75985
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.12215
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2.71212
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.53892
</td>
<td style="padding-left: 5px;padding-right: 5px;">
3.73296
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.99975
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.55580
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.23518
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.17717
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (proj model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.48610
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.46774
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.72672
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.09959
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.46288
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.05335
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.31737
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.45596
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.62771
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.67381
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: AGS
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: stateyear
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="11">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
</section>
<section id="robustness-additional-control-variables" class="level2">
<h2 class="anchored" data-anchor-id="robustness-additional-control-variables">Robustness: Additional Control Variables</h2>
<p>Test sensitivity of results to including additional covariates that may affect both EV adoption and health outcomes.</p>
<p><strong>Additional controls</strong>: - <strong>Average age</strong>: Controls for demographic composition (older populations have higher hospitalization rates) - <strong>GDP per capita (lagged)</strong>: Controls for economic development and healthcare access</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TWFE with additional controls</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>twfe_all_controls <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">+</span> average_age <span class="sc">+</span> GDP_per_capita_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>twfe_resp_controls <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> BEV_share_l1 <span class="sc">+</span> average_age <span class="sc">+</span> GDP_per_capita_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2SLS with additional controls</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Controls enter the second stage only (not as instruments)</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>tsls_all_controls <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    patients_all_per_1000 <span class="sc">~</span> average_age <span class="sc">+</span> GDP_per_capita_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>tsls_resp_controls <span class="ot">&lt;-</span> <span class="fu">felm</span>(</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    patients_resp_per_1000 <span class="sc">~</span> average_age <span class="sc">+</span> GDP_per_capita_l1 <span class="sc">|</span> AGS <span class="sc">+</span> stateyear <span class="sc">|</span> (BEV_share_l1 <span class="sc">~</span> PV_l1) <span class="sc">|</span> state <span class="sc">+</span> year,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> merged</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-tbl-cap="Robustness Check: Results with Additional Controls. Including average age and GDP per capita (lagged) tests whether main results are driven by demographic or economic confounders. Coefficients on BEV_share_l1 can be compared with baseline specifications to assess sensitivity. All specifications include district fixed effects (AGS) and state×year fixed effects. Standard errors clustered by state and year.">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TWFE"</span> <span class="ot">=</span> twfe_all_controls,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2SLS"</span> <span class="ot">=</span> tsls_all_controls,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TWFE"</span> <span class="ot">=</span> twfe_resp_controls,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2SLS"</span> <span class="ot">=</span> tsls_resp_controls</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.header =</span> <span class="fu">list</span>(</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"All Causes"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Respiratory Diseases"</span> <span class="ot">=</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.coef.map =</span> <span class="fu">list</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BEV_share_l1"</span> <span class="ot">=</span> <span class="st">"BEV Share (t-1)"</span>,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"`BEV_share_l1(fit)`"</span> <span class="ot">=</span> <span class="st">"BEV Share (t-1, instrumented)"</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"average_age"</span> <span class="ot">=</span> <span class="st">"Average Age"</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"GDP_per_capita_l1"</span> <span class="ot">=</span> <span class="st">"GDP per Capita (t-1)"</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">custom.gof.rows =</span> <span class="fu">list</span>(</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Demographic &amp; Economic Controls"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"✓"</span>, <span class="st">"✓"</span>, <span class="st">"✓"</span>, <span class="st">"✓"</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.rsquared =</span> <span class="cn">FALSE</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.adjrs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.fstatistic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th>
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="2">
All Causes
</th>
<th style="padding-left: 5px;padding-right: 5px;border-bottom: 1px solid #000000;" colspan="2">
Respiratory Diseases
</th>
</tr>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
TWFE
</th>
<th style="padding-left: 5px;padding-right: 5px;">
2SLS
</th>
<th style="padding-left: 5px;padding-right: 5px;">
TWFE
</th>
<th style="padding-left: 5px;padding-right: 5px;">
2SLS
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
BEV Share (t-1)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2.33722
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.11142
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.02334)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.08843)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
BEV Share (t-1, instrumented)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-6.22663
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.35720
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(11.97474)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.70562)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Average Age
</td>
<td style="padding-left: 5px;padding-right: 5px;">
8.05447<sup>**</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
9.25770<sup>*</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.13291
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.16780
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(1.53659)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(2.93583)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.53190)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.52296)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
GDP per Capita (t-1)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00014
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.00002
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.00001
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.00001
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.00007)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.00025)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.00001)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.00002)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Demographic &amp; Economic Controls
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
<td style="padding-left: 5px;padding-right: 5px;">
✓
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1998
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1998
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1968
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (full model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
220.98391
</td>
<td style="padding-left: 5px;padding-right: 5px;">
193.92927
</td>
<td style="padding-left: 5px;padding-right: 5px;">
69.43012
</td>
<td style="padding-left: 5px;padding-right: 5px;">
69.06424
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (full model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F statistic (proj model)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
14.15847
</td>
<td style="padding-left: 5px;padding-right: 5px;">
6.00487
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.91065
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.66027
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
F (proj model): p-value
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00000
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.00044
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.43482
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.57640
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: AGS
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
400
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
<td style="padding-left: 5px;padding-right: 5px;">
394
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. groups: stateyear
</td>
<td style="padding-left: 5px;padding-right: 5px;">
80
</td>
<td style="padding-left: 5px;padding-right: 5px;">
80
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
<td style="padding-left: 5px;padding-right: 5px;">
75
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="5">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>